---
import SidebarNav from './SidebarNav.astro';
---

<aside class="sidebar">
  <div class="sidebar-content">
    <!-- Search Input (Polar v1.1) -->
    <div class="sidebar-search-container">
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="search-icon"
      >
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.3-4.3"></path>
      </svg>
      <input
        type="search"
        class="sidebar-search"
        placeholder="Search..."
        aria-label="Search documentation"
      />
      <kbd class="search-kbd">âŒ˜K</kbd>
    </div>

    <SidebarNav />
  </div>
</aside>

<script>
  // Save and restore sidebar scroll position
  const sidebar = document.querySelector('.sidebar');

  if (sidebar) {
    // Restore scroll position on load
    const savedScrollPosition = localStorage.getItem('sidebar-scroll-position');
    if (savedScrollPosition) {
      sidebar.scrollTop = parseInt(savedScrollPosition, 10);
    }

    // Save scroll position on scroll
    let scrollTimeout: any;
    sidebar.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        localStorage.setItem('sidebar-scroll-position', sidebar.scrollTop.toString());
      }, 100);
    });
  }
</script>

<style>
  /* Sidebar (Polar v1.1) */
  .sidebar {
    width: var(--layout-sidebar-width);
    height: calc(100vh - var(--layout-header-height));
    background: var(--color-bg-secondary);
    border-inline-end: 1px solid var(--color-border);
    overflow-y: auto;
    position: sticky;
    top: var(--layout-header-height);
    padding: var(--space-6);
  }

  .sidebar-content {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  /* Search Input (Polar v1.1: 40px height, 6px border-radius) */
  .sidebar-search-container {
    position: relative;
    display: flex;
    align-items: center;
  }

  .search-icon {
    position: absolute;
    left: var(--space-3);
    color: var(--color-text-muted);
    pointer-events: none;
  }

  .sidebar-search {
    width: 100%;
    height: 40px;
    padding: var(--space-2-5) var(--space-3);
    padding-left: calc(var(--space-3) + 20px);
    padding-right: calc(var(--space-3) + 32px);
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    color: var(--color-text-primary);
    transition: all var(--duration-normal) var(--ease-out);
  }

  .sidebar-search:focus {
    outline: none;
    border-color: var(--color-border-focus);
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
  }

  .sidebar-search::placeholder {
    color: var(--color-text-muted);
  }

  .search-kbd {
    position: absolute;
    right: var(--space-3);
    padding: 2px var(--space-1-5);
    font-size: var(--text-xs);
    font-family: var(--font-mono);
    color: var(--color-text-muted);
    background: var(--color-bg-tertiary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    pointer-events: none;
  }

  /* Responsive (Polar v1.1) */
  @media (max-width: 1024px) {
    .sidebar {
      width: 240px;
    }
  }

  @media (max-width: 768px) {
    .sidebar {
      position: fixed;
      left: -100%;
      top: var(--layout-header-height);
      width: var(--layout-sidebar-width);
      z-index: var(--z-modal);
      transition: left var(--duration-slower) var(--ease-out);
      box-shadow: var(--shadow-lg);
    }

    .sidebar.open {
      left: 0;
    }
  }
</style>
